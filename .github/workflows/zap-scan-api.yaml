---
# This workflow will run the OWASP ZAP web application security scanner against
# the IDVA API Gateway

name: Zap-Scan-API

on:
  workflow_run:
    workflows: ["Deploy"]
    branches: [main]
    types: [completed]

jobs:
  zap_scan_api:
    if: github.repository_owner == '18F'
    runs-on: ubuntu-latest
    name: Scan the API Gateway - API
    steps:
      - uses: actions/checkout@v3

      - name: ZAP Scan (api)
        uses: zaproxy/action-full-scan@v0.3.0
        with:
          target: "https://idva-api-dev.app.cloud.gov"
          rules_file_name: ".zap/rules-api.tsv"
          issue_title: "ZAP Full Scan Report - API"
